local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local TeleportService = game:GetService("TeleportService")
local HttpService = game:GetService("HttpService")

local player = Players.LocalPlayer
local placeId = game.PlaceId
local targetPosition = Vector3.new(-2959.9, 41.2, 2162.7)

--------------------------------------------------
-- GUI SETUP
--------------------------------------------------

local screenGui = Instance.new("ScreenGui")
screenGui.Name = "ServerHopUI"
screenGui.ResetOnSpawn = false
screenGui.Parent = player:WaitForChild("PlayerGui")

local frame = Instance.new("Frame")
frame.Size = UDim2.new(0, 400, 0, 60)
frame.Position = UDim2.new(0.5, -200, 0, 20)
frame.BackgroundColor3 = Color3.fromRGB(90, 0, 160) -- Purple
frame.BorderSizePixel = 0
frame.Parent = screenGui

-- Rounded corners
local corner = Instance.new("UICorner")
corner.CornerRadius = UDim.new(0, 16)
corner.Parent = frame

-- Glow effect
local stroke = Instance.new("UIStroke")
stroke.Thickness = 4
stroke.Color = Color3.fromRGB(200, 150, 255)
stroke.Transparency = 0.3
stroke.Parent = frame

local label = Instance.new("TextLabel")
label.Size = UDim2.new(1, 0, 1, 0)
label.BackgroundTransparency = 1
label.Text = "Starting..."
label.TextColor3 = Color3.fromRGB(255,255,255)
label.Font = Enum.Font.GothamBold
label.TextScaled = true
label.Parent = frame

--------------------------------------------------
-- FUNCTIONS
--------------------------------------------------

local function updateStatus(text)
	label.Text = text
end

local function countdown(seconds)
	for i = seconds, 1, -1 do
		updateStatus("Server Hopping In: "..i.."s")
		task.wait(1)
	end
end

local function doEAction()
	print("E action triggered")
end

UserInputService.InputBegan:Connect(function(input, gameProcessed)
	if input.KeyCode == Enum.KeyCode.E and not gameProcessed then
		doEAction()
	end
end)

local function teleportToRandomServer()
	updateStatus("Finding Server...")

	local success, result = pcall(function()
		return HttpService:JSONDecode(
			game:HttpGetAsync(
				"https://games.roblox.com/v1/games/" .. placeId .. "/servers/Public?sortOrder=Asc&limit=100"
			)
		)
	end)

	if success and result and result.data then
		local servers = {}

		for _, server in pairs(result.data) do
			if server.playing < server.maxPlayers then
				table.insert(servers, server.id)
			end
		end

		if #servers > 0 then
			local randomServer = servers[math.random(1, #servers)]
			updateStatus("Teleporting...")
			task.wait(1)
			TeleportService:TeleportToPlaceInstance(placeId, randomServer, player)
		else
			updateStatus("No Servers Found")
		end
	else
		updateStatus("Fetch Failed")
	end
end

local function moveCharacter(character)
	local hrp = character:WaitForChild("HumanoidRootPart")

	updateStatus("Tweening To Spot...")

	local tween = TweenService:Create(
		hrp,
		TweenInfo.new(2, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
		{CFrame = CFrame.new(targetPosition)}
	)

	tween:Play()
	tween.Completed:Wait()

	doEAction()

	countdown(19)

	teleportToRandomServer()
end

if player.Character then
	moveCharacter(player.Character)
end

player.CharacterAdded:Connect(moveCharacter)
